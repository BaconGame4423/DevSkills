
# Feature Specification: 関数ビジュアライザー（Function Visualizer with Differentiation）

**Created**: 2026-02-17
**Status**: Draft
**Input**: User description: "微分機能付きインタラクティブ数学ツール「関数ビジュアライザー」を開発してください。要件: FR-001: インタラクティブ関数グラフ表示, FR-002: 数式入力フィールド, FR-003: リアルタイムグラフ更新, FR-004: 自動ズーム/スケール, FR-005: 軸ラベルとグリッド線, FR-006: 複数関数サポート (sin,cos,tan,log,exp,sqrt,abs), FR-007: 微分（導関数）の計算と表示, FR-008: 導関数のグラフ重畳表示, FR-009: カーソル追従ツールチップ (x, f(x), f'(x)), FR-010: 接線表示, FR-011: レスポンシブデザイン, FR-012: エラーハンドリング（不正入力）, FR-013: プリセット関数ボタン"

## User Scenarios & Testing

### User Story 1 - 基本グラフ描画 (Priority: P1)

学生や教育者が数式を入力し、視覚的に関数の振る舞いを理解したい。数式入力フィールドに sin(x) や x^2 などを入力すると、即座にグラフが描画される。

**Why this priority**: このツールの核心機能であり、すべての他機能の基盤となる
**Independent Test**: 入力フィールドに "x^2" を入力し、放物線が表示されることを確認

**Acceptance Scenarios**:
1. **Given** ユーザーがツールを開いた状態, **When** "sin(x)" を入力, **Then** 正弦波グラフが表示される
2. **Given** グラフが表示されている, **When** 入力を "cos(x)" に変更, **Then** リアルタイムで余弦波に更新される
3. **Given** 入力フィールドが空, **When** ユーザーが入力開始, **Then** 入力中もグラフが動的に更新される

---

### User Story 2 - 導関数の可視化 (Priority: P1)

微積分学習者が関数とその導関数の関係を視覚的に理解したい。元の関数と導関数を同じグラフ上で比較できる。

**Why this priority**: ツールの差別化機能であり、微分概念の理解に不可欠
**Independent Test**: x^2 を入力し、導関数 2x が自動計算・表示されることを確認

**Acceptance Scenarios**:
1. **Given** 関数が入力されている, **When** 導関数表示オプションを有効化, **Then** 導関数のグラフが重畳表示される
2. **Given** x^3 が入力されている, **When** 導関数計算, **Then** 3x^2 が計算され表示される
3. **Given** 導関数が表示されている, **When** 元関数を変更, **Then** 導関数も自動更新される

---

### User Story 3 - カーソル追従と接線 (Priority: P2)

特定の点での関数値、導関数値、接線の傾きを視覚的に確認したい。カーソル位置に応じてツールチップが情報を表示し、接線を描画できる。

**Why this priority**: 学習の深掘りに重要だが、基本機能の後に使用される
**Independent Test**: グラフ上でマウスを動かし、ツールチップに x, f(x), f'(x) が表示されることを確認

**Acceptance Scenarios**:
1. **Given** グラフが表示されている, **When** カーソルをグラフ上に移動, **Then** 現在の x, f(x), f'(x) がツールチップで表示される
2. **Given** カーソルがグラフ上にある, **When** 接線表示を有効化, **Then** その点での接線が描画される
3. **Given** 接線が表示されている, **When** カーソルを移動, **Then** 接線が新しい位置に更新される

---

### User Story 4 - プリセット関数と複数関数タイプ (Priority: P2)

よく使用される関数を素早く選択したい。プリセットボタンで sin, cos, tan, log, exp, sqrt, abs などをワンクリックで入力できる。

**Why this priority**: 利便性向上だが、手動入力でも代替可能
**Independent Test**: プリセットボタン "sin(x)" をクリックし、正弦波が表示されることを確認

**Acceptance Scenarios**:
1. **Given** ツールを開いた状態, **When** "sin(x)" プリセットボタンをクリック, **Then** 入力フィールドに "sin(x)" が入力されグラフが表示される
2. **Given** 入力フィールドがある値, **When** プリセットボタンをクリック, **Then** 入力フィールドが上書きされる

---

### User Story 5 - レスポンシブと自動スケール (Priority: P3)

様々なデバイス（デスクトップ、タブレット、スマートフォン）で利用し、グラフが適切にスケールされる。

**Why this priority**: アクセシビリティ向上だが、機能的には必須ではない
**Independent Test**: ブラウザウィンドウサイズを変更し、グラフがリサイズされることを確認

**Acceptance Scenarios**:
1. **Given** デスクトップで表示, **When** ウィンドウをリサイズ, **Then** グラフが新しいサイズに合わせて調整される
2. **Given** 関数の値域が広い, **When** グラフ描画, **Then** 適切なズームレベルに自動調整される
3. **Given** スマートフォンで表示, **When** ツールを開く, **Then** タッチ操作に最適化されたレイアウトで表示される

---

### Edge Cases
- 不正な数式（例: "sin(" 閉じ括弧なし、"log(0)"、"1/0"）を入力した場合どうなるか？
- 定義域外の値（例: sqrt(-1)、log(負の値)）をどう処理するか？
- 複雑な合成関数（例: sin(cos(tan(x)))）の微分計算限界は？
- 極めて大きな値や小さな値を持つ関数の表示方法は？

## Requirements

### Functional Requirements
- **FR-001**: システムは入力された数式に基づいてインタラクティブな関数グラフを表示しなければならない
- **FR-002**: システムは数式入力フィールドを提供し、ユーザーが関数を入力できるようにしなければならない
- **FR-003**: システムは入力変更時にリアルタイムでグラフを更新しなければならない
- **FR-004**: システムは関数の範囲に応じて自動的にズーム・スケールを調整しなければならない
- **FR-005**: システムは軸ラベルとグリッド線を表示し、値の読み取りを容易にしなければならない
- **FR-006**: システムは sin, cos, tan, log, exp, sqrt, abs 関数をサポートしなければならない
- **FR-007**: システムは入力された関数の導関数（微分）を自動計算しなければならない
- **FR-008**: システムは導関数のグラフを元のグラフに重畳表示しなければならない
- **FR-009**: システムはカーソル位置に応じて x, f(x), f'(x) をツールチップで表示しなければならない
- **FR-010**: システムはカーソル位置での接線を表示しなければならない
- **FR-011**: システムは様々な画面サイズに対応したレスポンシブデザインを提供しなければならない
- **FR-012**: システムは不正な入力に対して適切なエラーメッセージを表示しなければならない
- **FR-013**: システムはよく使用される関数のプリセットボタンを提供しなければならない

### Key Entities
- **Function（関数）**: ユーザーが入力する数式文字列、例: "sin(x)", "x^2 + 2*x - 1"
- **Derivative（導関数）**: 関数から自動計算される微分式、システム内部で管理
- **Graph Point（グラフ点）**: (x, y) 座標ペア、描画用の離散点集合
- **Tooltip Data（ツールチップデータ）**: 現在のカーソル位置における x, f(x), f'(x) の値
- **Tangent Line（接線）**: 特定点での関数の接線、傾きと切片で表現

## Success Criteria

### Measurable Outcomes
- **SC-001**: 数式入力からグラフ表示まで 500ms 以内に完了すること
- **SC-002**: 導関数計算が 200ms 以内に完了すること
- **SC-003**: 不正入力時に 100% 適切なエラーメッセージが表示されること
- **SC-004**: サポート対象デバイス（デスクトップ、タブレット、スマートフォン）で 100% 正常動作すること
- **SC-005**: ツールチップの更新がカーソル移動に遅延なく追従すること（16ms/60fps 以下）

---

[NEEDS CLARIFICATION: FR-007/FR-008 - 導関数の計算は数式レベル（シンボリック微分）で行い数式を表示する必要があるか、それとも数値計算のみで十分か？]
[NEEDS CLARIFICATION: 複数の関数を同時に表示・比較する機能（マルチプロット）は必要か？]
[NEEDS CLARIFICATION: グラフ画像のエクスポート機能（PNG/SVG保存）は必要か？]

## Clarifications

### 2026-02-17

**Questions:**

  1. FR-007/FR-008 - 導関数の計算は数式レベル（シンボリック微分）で行い数式を表示する必要があるか、それとも数値計算のみで十分か？
  2. 複数の関数を同時に表示・比較する機能（マルチプロット）は必要か？
  3. グラフ画像のエクスポート機能（PNG/SVG保存）は必要か？

**Answers:**

FR-007/FR-008 - 導関数の計算: 数値計算のみ（推奨）
複数の関数を同時に表示・比較する機能（マルチプロット）: なし（推奨）
グラフ画像のエクスポート機能（PNG/SVG保存）: なし（推奨）

