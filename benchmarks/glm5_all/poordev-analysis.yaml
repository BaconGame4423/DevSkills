workflow:
  pipeline_adherence:
    completed_steps: [specify, suggest, plan, planreview, tasks, tasksreview, implement]
    skipped_steps: [architecturereview, qualityreview, phasereview]
    notes: |
      パイプラインは specify→suggest→plan→planreview→tasks→tasksreview→implement まで進行。
      implement 後のレビューステップ3種（architecture/quality/phase）がスキップされている。
      git log から、実装は4フェーズ（Setup/Foundational/US1/US2）でコミットされている。
  information_flow:
    gaps:
      - step: tasksreview→implement
        description: "tasks.md のタスクが全て [ ]（未完了）のまま、実装が完了している。タスク完了マーカーの更新が欠落"
      - step: implement→review
        description: "implement 完了後の3種レビュー（architecturereview/qualityreview/phasereview）が実行されていない"
    notes: |
      spec→plan→tasks→code の論理的整合は保たれているが、
      実装完了のフィードバックループ（tasks.md 更新、レビュー実行）が機能していない。
  bottlenecks:
    issues:
      - phase: implement
        description: "4フェーズ実行中にパイプラインが中断された可能性。_runs/ には phase_3 までの記録"
      - phase: review
        description: "レビューログが空（iterations: []、issues: 空）。実質的にレビューが実行されなかった可能性"
    notes: |
      planreview/tasksreview のログは作成されているが中身が空。
      実際にペルソナがディスパッチされたか、結果が記録されたかが不明。
  review_effectiveness:
    useful_fixes: 0
    noise_fixes: 0
    notes: |
      review-log-planreview.yaml と review-log-tasksreview.yaml の両方が空。
      これは以下のいずれかを示唆:
      1) 実際に指摘ゼロ（品質が完璧）
      2) ペルソナディスパッチが失敗
      3) 結果の書き込みが失敗
      GLM-5 の能力を考慮すると (2) or (3) の可能性が高い。

commands:
  issues:
    - command: poor-dev.planreview.md / poor-dev.tasksreview.md
      severity: H
      description: |
        レビュー結果が空として記録されている。review-loop.md テンプレートは詳細だが、
        実際のペルソナディスパッチと結果収集のフローが機能していない可能性。
      suggestion: |
        review-runner.sh のログ出力を強化し、ペルソナごとのディスパッチ結果を
        明示的に記録するよう修正。空結果の場合は警告を出力すべき。
    - command: poor-dev.implement.md
      severity: M
      description: |
        タスク完了時に tasks.md の `[ ]` を `[X]` に更新する指示があるが、
        実際には更新されていない（tasks.md は全て `[ ]` のまま）。
      suggestion: |
        実装完了後の tasks.md 更新を強制するチェックを追加。
        または pipeline-runner.sh 側で自動更新フックを実装。
    - command: poor-dev.md (Step 3b)
      severity: M
      description: |
        pipeline-runner.sh --next ループの終了判定が複雑で、
        step_complete vs pipeline_complete の区別が曖昧。
      suggestion: |
        JSON 出力を標準化し、終了判定をより明確に。
        `{"status": "step_complete", "step": "implement"}` のような形式に統一。
    - command: templates/review-loop.md
      severity: L
      description: |
        テンプレートが119行と長く、複雑な条件分岐が多い。
        GLM-5 のような低コンテキストモデルでは理解が困難な可能性。
      suggestion: |
        review-loop.md を分割: 基本フロー + 詳細設定 + 例外処理。
        各セクションを独立した include 可能な形式に。
    - command: poor-dev.implement.md
      severity: L
      description: |
        実装コマンドが233行と非常に長い。Ignore file 作成等の詳細指示が
        実装の本質ではない情報でプロンプトを圧迫している。
      suggestion: |
        共通設定（ignore files 等）を別テンプレートに抽出。
        実装コマンドはタスク実行に集中した形に短縮。
  strengths:
    - "spec.md のフォーマットが優秀: User Story + Acceptance Scenarios + Edge Cases が明確"
    - "plan.md のデータフロー図とインターフェース定義が実装に直結"
    - "suggestions.yaml による事前調査結果の活用が効果的"
    - "生成コードの品質が高い: ES6 modules, 適切なエラーハンドリング, 日本語メッセージ"

model_fit:
  difficult_steps:
    - step: planreview / tasksreview
      reason: |
        review-loop.md テンプレートが複雑（119行、多層的条件分岐）。
        GLM-5 のコンテキスト理解能力では、ペルソナ並列ディスパッチ、
        結果集約、重複排除、収束判定を正確に実行することが困難だった可能性。
      suggestion: |
        レビューはより単純な逐次処理に変更、または Claude/GPT-4 に委譲。
        config.json で `step_tiers.planreview: "high"` を設定し、
        高性能モデルを強制的に使用させる。
    - step: implement (task tracking)
      reason: |
        実装自体は成功しているが、tasks.md の完了マーカー更新が漏れている。
        これは指示の理解よりも、複数ファイルの同時編集というタスク管理の限界。
      suggestion: |
        タスク完了マーカーの更新を別ステップとして自動化、
        またはコミット前に tasks.md の整合性をチェックする validation を追加。
  prompt_issues:
    - issue: "review-loop.md の STEP 0.3 (Risk-Based Depth) は GLM-5 には過剰に複雑"
    - issue: "cross-CLI routing の条件分岐（claude/opencode 判定）が理解しにくい"
    - issue: "implement.md の ignore file パターン一覧がプロンプトトークンを浪費"
  context_window_pressure:
    worst_step: "tasksreview / planreview"
    estimated_tokens: 15000
    notes: |
      review-loop.md (119行) + 対象ファイル (tasks.md: 137行 / plan.md: 152行) +
      review-log + ペルソナ出力を処理する必要がある。
      GLM-5 の実効コンテキストでは限界に近い。
  tier_recommendations:
    specify: "low"
    suggest: "medium"
    plan: "medium"
    planreview: "high"
    tasks: "low"
    tasksreview: "high"
    implement: "medium"
    architecturereview: "high"
    qualityreview: "high"
    phasereview: "high"

summary:
  top_issues:
    - priority: 1
      issue: "レビューステップ（planreview/tasksreview）が実質的にスキップされている"
      impact: "品質ゲートが機能せず、バグや設計問題が見逃される可能性"
    - priority: 2
      issue: "tasks.md のタスク完了マーカーが更新されていない"
      impact: "進捗追跡が不可能、再開時に重複作業や欠落が発生"
    - priority: 3
      issue: "生成コードがルートディレクトリと specs/ に重複配置"
      impact: "どちらが正か不明、メンテナンス混乱の原因"
  quick_wins:
    - action: "review-runner.sh に空結果時の警告ログ追加"
      effort: "低"
      impact: "レビュー失敗の早期検出"
    - action: "implement 完了後に tasks.md の [ ]→[X] 自動更新フック追加"
      effort: "中"
      impact: "進捗追跡の正確性向上"
    - action: "生成コードの出力先を specs/*/ に統一（ルートディレクトリにコピーしない）"
      effort: "低"
      impact: "ファイル重複の解消"
  strategic:
    - action: "レビューパイプラインの簡素化"
      description: |
        review-loop.md を GLM-5 でも実行可能な形に再設計。
        逐次処理 + 明確な終了条件に変更。
      timeline: "中期的（2-4週間）"
    - action: "ステップ別モデル設定の強制適用"
      description: |
        config.json の step_tiers で高性能モデルを指定したステップは、
        現在のモデルに関わらず強制的に切り替える仕組みを実装。
      timeline: "短期的（1-2週間）"
    - action: "パイプライン状態の可視化ダッシュボード"
      description: |
        docs/progress.md を自動更新し、各ステップの成功/失敗/スキップを
        ユーザーが即座に確認できる仕組み。
      timeline: "中期的（2-4週間）"
